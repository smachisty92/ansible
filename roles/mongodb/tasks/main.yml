- name: Copy MongoDB repo
  ansible.builtin.copy:
    src: mongo.repo
    dest: /etc/yum.repos.d/mongo.repo

- name: Install Mongodb
  ansible.builtin.yum:
    name: mongodb-org
    state: installed


- name: Update MongoDB listen address
  ansible.builtin.replace:
    path: /etc/mongod.conf
    regexp: '127.0.0.1'
    replace: '0.0.0.0'

- name: Start MongoDB service
  ansible.builtin.systemd:
    name: mongod
    state: restarted
    enabled: yes

- name: Download Database code
  import_role:
    name: common
    tasks_from: download

- name: Load Schema - Catalogue
  community.mongodb.mongodb_shell:
    file: "/tmp/mongodb-main/catalogue.js"
    idempotent: yes # it will try to do it, if its not there and if its there it will ignore, if we dont use it everytime we run it will create and everytime it will throw error

- name: Load Schema - user
  community.mongodb.mongodb_shell:
    file: "/tmp/mongodb-main/users.js"
    idempotent: yes
#
### Install MongoDB Manual Steps.
#
#Ref URL: [https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/)
#
#  1. Setup MongoDB repos.
#
#  ```bash
#  curl -s -o /etc/yum.repos.d/mongodb.repo https://raw.githubusercontent.com/roboshop-devops-project/mongodb/main/mongo.repo
#  ```
#
#  1. Install Mongo & Start Service.
#
#  ```bash
#  # yum install -y mongodb-org
#  # systemctl enable mongod
#  # systemctl start mongod
#
#  ```
#
#  1. Update Listen IP address from 127.0.0.1 to 0.0.0.0 in config file
#
#Config file: `/etc/mongod.conf`
#
#  then restart the service
#
#  ```bash
#  # systemctl restart mongod
#
#  ```
#
#  ## Every Database needs the schema to be loaded for the application to work.
#
#  Download the schema and load it.
#
#  ```
#  # curl -s -L -o /tmp/mongodb.zip "https://github.com/roboshop-devops-project/mongodb/archive/main.zip"
#
#  # cd /tmp
#  # unzip mongodb.zip
#  # cd mongodb-main
#  # mongo < catalogue.js
#  # mongo < users.js
#
#  ```
#
#  Symbol `<` will take the input from a file and give that input to the command.